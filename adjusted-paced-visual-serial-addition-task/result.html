<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.1/xlsx.full.min.js"></script> 
        <script src="global.js"></script>
        <style>
            html,body{
                margin:0;
                padding:0;
                background-color: #f6f6f6;
            }
        </style>
        <script>
            $(function() {
                $('#reset').on('click',function(){
                    window.location.assign('/');
                });
                $("#download").on('click',function(){
                    var result = getLocalStorage('result-'+getUrlParameter('result_id'));
                    let Heading = [['題目出現時間', '回答時間', '前一數字', '當前數字', '使用者回答', '測驗結果', '當前答題時間', '使用者反應時間']];
                    result = result.map(function(item){
                        item['reflectTime'] = Number(item['userAnswerTime']) - Number(item['questionStartTime']);
                        return item;
                    });
                    //Had to create a new workbook and then add the header
                    const wb = XLSX.utils.book_new();
                    const ws = XLSX.WorkSheet = XLSX.utils.json_to_sheet([]);
                    XLSX.utils.sheet_add_aoa(ws, Heading);

                    XLSX.utils.sheet_add_json(ws, result, { origin: 'A2', skipHeader: true });

                    XLSX.utils.book_append_sheet(wb, ws, "測驗結果");
                    
                    XLSX.writeFile(wb,'測驗結果-'+getUrlParameter('result_id')+'.xlsx');
                    
            
                });
            });
        </script>
    </head>
    
    <body>
        <div class="container">
            <div class="row align-items-center h-100">
                <div class="col-lg-10 col-xl-10 mx-auto">
                    <div class="text-center" style="font-size: x-large;">
                        <div>Adjusted Paced Visual Serial Addition Task<br>適性序列視覺加法作業</div>
                    </div>
                    <hr style="margin-bottom: 5rem; margin-top: 2rem;">
                    <div class="form-floating my-5">
                        感謝您的耐心測試。
                    </div>
                    <hr style="margin-bottom: 5rem;">
                    <div class="text-center">
                        <button class="w-50 btn btn-lg btn-success my-2" id="download"><i class="fa-solid fa-file-lines"></i> 下載測試結果</button>
                        <button class="w-50 btn btn-lg btn-secondary my-2" id="reset">返回設定頁</button>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>