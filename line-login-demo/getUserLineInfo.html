<html>
    <head>
        <meta name="author" content="injWang, a271954@gmail.com">
        <meta name="description" content="如有需求請聯繫上方Email">
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <meta property="og:url"                content="https://fus1.github.io/line-login-demo" />
        <meta property="og:type"               content="website" />
        <meta property="og:locale"             content="zh_TW" />
        <meta property="og:title"              content="LINE-LOGIN-測試" />
        <meta property="og:description"        content="LINE-LOGIN-測試" />
        <meta property="og:image"              content="img/Line-Logo.png" />
        <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Sans+TC">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.1.3/axios.min.js"></script>
        <style>
            html,body{
                font-family: 'Noto Sans TC', sans-serif;
                margin:0;
                padding:0;
                background-color: #f6f6f6;
            }
        </style>
        <script>
            /***************************************
             *  Made By injWang                    *
             *  contact Email : a271954@gmail.com  *
             ***************************************/   
               
            var getUrlParameter = function(sParam) {
                var sPageURL = window.location.search.substring(1),
                    sURLVariables = sPageURL.split('&'),
                    sParameterName,
                    i;

                for (i = 0; i < sURLVariables.length; i++) {
                    sParameterName = sURLVariables[i].split('=');

                    if (sParameterName[0] === sParam) {
                        return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                    }
                }
                return false;
            };

            var parseJwt = function(token) {
                var base64Url = token.split('.')[1];
                var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
                    return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
                }).join(''));

                return JSON.parse(jsonPayload);
            }

            axios({
                method:'POST',
                url:'https://api.line.me/oauth2/v2.1/token',
                data:{
                    grant_type:'authorization_code',
                    code:getUrlParameter('code'),
                    redirect_uri:'https://fus1.github.io/line-login-demo/getUserLineInfo.html',
                    client_id:'1657658890',
                    client_secret:'a8f168b8798d29a1458445bdd6231737',
                },
                headers: { 
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
            }).then(function (response) {
                console.log(response.data);
                
                let data = response.data;
                let userData = parseJwt(response.data.id_token); 
                for (const key in data) {
                    try {
                        document.getElementsByName(key).value = data[key];
                    } catch (error) {

                    }
                }
                
                for (const key in userData) {
                    try {
                        document.getElementsByName(key).innerHTML = userData[key];
                    } catch (error) {

                    }
                }
                document.getElementsByName('picture').src = userData['picture'];
                
            });


        </script>
    </head>
    
    <body class="bg-slate-800">

        <div class="py-20 px-8 mx-auto w-fit" >
            <a href="https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=1657658890&redirect_uri=https://fus1.github.io/line-login-demo/getUserLineInfo.html&state=12345abcde&scope=profile%20openid%20email"><img src="img/Line-Login-Button.png"></a>    
        </div>
        
        <figure class="mx-auto w-11/12 bg-slate-800 rounded-xl py-8 border-2 border-sky-400">
            <img class="w-24 h-24 rounded-full mx-auto" name="picture" src="https://profile.line-scdn.net/0hvYsFw8MyKXZOPzxb8kRWIXJ6Jxs5ES8-NgpgFGw-IxFqB2codlkzFTw9JBMwC2smJlhgRG49dkIx" alt="" width="384" height="512">
            <div class="pt-6 text-center space-y-4">
              <figcaption class="font-medium">
                <div class="text-sky-400" name="name">
                
                </div>
                <div class="text-slate-700">
                  <span>Line ID :</span> <span name="sub"></span>
                </div>
              </figcaption>
              <blockquote>
                <p class="text-white text-lg font-medium" name="access_token">
                  
                </p>
              </blockquote>
            </div>
        </figure>

    </body>
</html>