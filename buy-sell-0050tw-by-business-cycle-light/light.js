var lightValue = {
    '2003-07':24,
    '2003-08':26,
    '2003-09':29,
    '2003-10':31,
    '2003-11':30,
    '2003-12':34,
    '2004-01':35,
    '2004-02':34,
    '2004-03':36,
    '2004-04':37,
    '2004-05':39,
    '2004-06':36,
    '2004-07':35,
    '2004-08':33,
    '2004-09':32,
    '2004-10':29,
    '2004-11':28,
    '2004-12':26,
    '2005-01':23,
    '2005-02':23,
    '2005-03':22,
    '2005-04':20,
    '2005-05':18,
    '2005-06':20,
    '2005-07':19,
    '2005-08':23,
    '2005-09':23,
    '2005-10':24,
    '2005-11':24,
    '2005-12':27,
    '2006-01':28,
    '2006-02':28,
    '2006-03':23,
    '2006-04':23,
    '2006-05':24,
    '2006-06':21,
    '2006-07':21,
    '2006-08':22,
    '2006-09':22,
    '2006-10':20,
    '2006-11':21,
    '2006-12':16,
    '2007-01':18,
    '2007-02':19,
    '2007-03':23,
    '2007-04':18,
    '2007-05':20,
    '2007-06':25,
    '2007-07':30,
    '2007-08':30,
    '2007-09':32,
    '2007-10':32,
    '2007-11':28,
    '2007-12':29,
    '2008-01':29,
    '2008-02':27,
    '2008-03':26,
    '2008-04':27,
    '2008-05':22,
    '2008-06':20,
    '2008-07':16,
    '2008-08':18,
    '2008-09':12,
    '2008-10':12,
    '2008-11':11,
    '2008-12':9,
    '2009-01':9,
    '2009-02':10,
    '2009-03':10,
    '2009-04':11,
    '2009-05':12,
    '2009-06':17,
    '2009-07':18,
    '2009-08':18,
    '2009-09':20,
    '2009-10':26,
    '2009-11':37,
    '2009-12':37,
    '2010-01':38,
    '2010-02':38,
    '2010-03':39,
    '2010-04':39,
    '2010-05':37,
    '2010-06':37,
    '2010-07':38,
    '2010-08':38,
    '2010-09':37,
    '2010-10':34,
    '2010-11':32,
    '2010-12':34,
    '2011-01':34,
    '2011-02':34,
    '2011-03':31,
    '2011-04':29,
    '2011-05':27,
    '2011-06':25,
    '2011-07':23,
    '2011-08':20,
    '2011-09':21,
    '2011-10':19,
    '2011-11':16,
    '2011-12':14,
    '2012-01':13,
    '2012-02':15,
    '2012-03':14,
    '2012-04':14,
    '2012-05':15,
    '2012-06':15,
    '2012-07':16,
    '2012-08':15,
    '2012-09':20,
    '2012-10':19,
    '2012-11':21,
    '2012-12':22,
    '2013-01':19,
    '2013-02':20,
    '2013-03':18,
    '2013-04':17,
    '2013-05':19,
    '2013-06':23,
    '2013-07':20,
    '2013-08':20,
    '2013-09':20,
    '2013-10':21,
    '2013-11':21,
    '2013-12':24,
    '2014-01':22,
    '2014-02':25,
    '2014-03':25,
    '2014-04':29,
    '2014-05':24,
    '2014-06':26,
    '2014-07':27,
    '2014-08':29,
    '2014-09':27,
    '2014-10':24,
    '2014-11':25,
    '2014-12':22,
    '2015-01':23,
    '2015-02':24,
    '2015-03':22,
    '2015-04':16,
    '2015-05':18,
    '2015-06':16,
    '2015-07':14,
    '2015-08':14,
    '2015-09':14,
    '2015-10':15,
    '2015-11':15,
    '2015-12':14,
    '2016-01':14,
    '2016-02':16,
    '2016-03':16,
    '2016-04':17,
    '2016-05':20,
    '2016-06':20,
    '2016-07':23,
    '2016-08':25,
    '2016-09':23,
    '2016-10':24,
    '2016-11':26,
    '2016-12':28,
    '2017-01':29,
    '2017-02':28,
    '2017-03':24,
    '2017-04':21,
    '2017-05':20,
    '2017-06':22,
    '2017-07':22,
    '2017-08':25,
    '2017-09':28,
    '2017-10':23,
    '2017-11':23,
    '2017-12':22,
    '2018-01':20,
    '2018-02':24,
    '2018-03':23,
    '2018-04':26,
    '2018-05':29,
    '2018-06':22,
    '2018-07':26,
    '2018-08':24,
    '2018-09':22,
    '2018-10':22,
    '2018-11':17,
    '2018-12':16,
    '2019-01':20,
    '2019-02':17,
    '2019-03':20,
    '2019-04':21,
    '2019-05':18,
    '2019-06':21,
    '2019-07':22,
    '2019-08':20,
    '2019-09':19,
    '2019-10':19,
    '2019-11':24,
    '2019-12':27,
    '2020-01':25,
    '2020-02':24,
    '2020-03':20,
    '2020-04':19,
    '2020-05':19,
    '2020-06':19,
    '2020-07':21,
    '2020-08':26,
    '2020-10':28,
    '2020-11':30,
    '2020-12':34,
    '2021-01':37,
    '2021-02':40,
    '2021-03':40,
    '2021-04':41,
    '2021-05':41,
    '2021-06':40,
    '2021-07':38,
    '2021-08':39,
    '2021-09':38,
    '2021-10':39,
    '2021-11':37,
    '2021-12':38,
    '2022-01':36,
    '2022-02':34,
    '2022-03':31,
    '2022-04':28,
    '2022-05':28,
    '2022-06':27,
    '2022-07':24,
    '2022-08':23,
    '2022-09':17,
};

var tw0050 = {
'2005-01':	47.09,
'2005-02':	48.63,
'2005-03':	46.75,
'2005-04':	45.78,
'2005-05':	45.51,
'2005-06':	47.49,
'2005-07':	48.17,
'2005-08':	46.7,
'2005-09':	47.45,
'2005-10':	45.44,
'2005-11':	48.79,
'2005-12':	51.25,
'2006-01':	51.35,
'2006-02':	52.4,
'2006-03':	52.8,
'2006-04':	56.8,
'2006-05':	56.8,
'2006-06':	53.1,
'2006-07':	51.4,
'2006-08':	54.25,
'2006-09':	56.35,
'2006-10':	53.4,
'2006-11':	56.3,
'2006-12':	57.75,
'2007-01':	56.7,
'2007-02':	57.75,
'2007-03':	56.45,
'2007-04':	56.9,
'2007-05':	59.75,
'2007-06':	65,
'2007-07':	66.3,
'2007-08':	65.6,
'2007-09':	69.35,
'2007-10':	70.2,
'2007-11':	61.8,
'2007-12':	61.45,
'2008-01':	54.95,
'2008-02':	60.470001,
'2008-03':	60.82,
'2008-04':	63.560001,
'2008-05':	61.73,
'2008-06':	55.419998,
'2008-07':	52.380001,
'2008-08':	53.610001,
'2008-09':	45.119999,
'2008-10':	35.75,
'2008-11':	32.099998,
'2008-12':	33.099998,
'2009-01':	30.5,
'2009-02':	33.049999,
'2009-03':	36.639999,
'2009-04':	42.150002,
'2009-05':	48,
'2009-06':	44.459999,
'2009-07':	49.02,
'2009-08':	48.450001,
'2009-09':	53.299999,
'2009-10':	51.650002,
'2009-11':	52.700001,
'2009-12':	56.450001,
'2010-01':	53,
'2010-02':	51.549999,
'2010-03':	54.25,
'2010-04':	54.799999,
'2010-05':	50.099998,
'2010-06':	49.549999,
'2010-07':	53.900002,
'2010-08':	53.299999,
'2010-09':	57.700001,
'2010-10':	56,
'2010-11':	57.099998,
'2010-12':	61.400002,
'2011-01':	63,
'2011-02':	63.650002,
'2011-03':	59.549999,
'2011-04':	62,
'2011-05':	62,
'2011-06':	58.849998,
'2011-07':	59.900002,
'2011-08':	54.549999,
'2011-09':	51.650002,
'2011-10':	52.200001,
'2011-11':	48.080002,
'2011-12':	49.810001,
'2012-01':	51.950001,
'2012-02':  56,
'2012-03':	54.900002,
'2012-04':	52.049999,
'2012-05':	50.150002,
'2012-06':	50.200001,
'2012-07':	51.099998,
'2012-08':	52.75,
'2012-09':	55.150002,
'2012-10':	50.400002,
'2012-11':	53.549999,
'2012-12':	53.799999,
'2013-01':	54.599998,
'2013-02':	55.200001,
'2013-03':	55.099998,
'2013-04':	56.400002,
'2013-05':	56.950001,
'2013-06':	55.099998,
'2013-07':	56.599998,
'2013-08':	55.849998,
'2013-09':	57.150002,
'2013-10':	57.900002,
'2013-11':	57.549999,
'2013-12':	58.700001,
'2014-01':	57.599998,
'2014-02':	58.299999,
'2014-03':	60.099998,
'2014-04':	61,
'2014-05':	63.099998,
'2014-06':	65.949997,
'2014-07':	66.75,
'2014-08':	69.199997,
'2014-09':	65.300003,
'2014-10':	65.300003,
'2014-11':	67.5,
'2014-12':	66.849998,
'2015-01':	68,
'2015-02':	70.300003,
'2015-03':	69.050003,
'2015-04':	71.449997,
'2015-05':	71.099998,
'2015-06':	69.400002,
'2015-07':	66.150002,
'2015-08':	62.299999,
'2015-09':	62.400002,
'2015-10':	63.200001,
'2015-11':	61.200001,
'2015-12':	60.75,
'2016-01':	59.59,
'2016-02':	61.25,
'2016-03':	64.650002,
'2016-04':	61.599998,
'2016-05':	63.150002,
'2016-06':	65.449997,
'2016-07':	68.550003,
'2016-08':	69.400002,
'2016-09':	70.949997,
'2016-10':	72.599998,
'2016-11':	71.699997,
'2016-12':	71.800003,
'2017-01':	73.300003,
'2017-02':	73.150002,
'2017-03':	73.699997,
'2017-04':	74.550003,
'2017-05':	76.5,
'2017-06':	80.400002,
'2017-07':	81.349998,
'2017-08':	82.949997,
'2017-09':	81.07,
'2017-10':	85.199997,
'2017-11':	82.25,
'2017-12':	82.150002,
'2018-01':	84.650002,
'2018-02':	82.349998,
'2018-03':	82.949997,
'2018-04':	80,
'2018-05':	80.75,
'2018-06':	81.449997,
'2018-07':  85.550003,
'2018-08':	86.949997,
'2018-09':	86.900002,
'2018-10':	77.550003,
'2018-11':	76.75,
'2018-12':	75.5,
'2019-01':	74.349998,
'2019-02':	77.650002,
'2019-03':	79.150002,
'2019-04':	82.800003,
'2019-05':	78.449997,
'2019-06':	80.900002,
'2019-07':	82.800003,
'2019-08':	81.849998,
'2019-09':	84.599998,
'2019-10':	90.099998,
'2019-11':	91.5,
'2019-12':	96.949997,
'2020-01':	89.949997,
'2020-02':	88.650002,
'2020-03':	76.150002,
'2020-04':	85.5,
'2020-05':	84.449997,
'2020-06':	89.900002,
'2020-07':	103.800003,
'2020-08':	101.800003,
'2020-09':	103,
'2020-10':	103,
'2020-11':	113.300003,
'2020-12':	122.25,
'2021-01':	128.199997,
'2021-02':	133.399994,
'2021-03':	134.75,
'2021-04':	140.600006,
'2021-05':	137.100006,
'2021-06':	138.949997,
'2021-07':	136.050003,
'2021-08':	140.350006,
'2021-09':	137.050003,
'2021-10':	135.800003,
'2021-11':	138,
'2021-12':	145.5,
'2022-01':	141.550003,
'2022-02':	138.5,
'2022-03':	138.100006,
'2022-04':	128.75,
'2022-05':	129.800003,
'2022-06':	115.800003,
'2022-07':	118,
'2022-08':	117.599998,
'2022-09':	103.449997,
'2022-10':	99.050003,
'2022-11':	114.550003,

};

var myMoney = 25000000; //現有資金

//燈號門檻
var rangeConfig = {
    veryLow : 16,   //原16
    low     : 21,   //原22
    normal  : 31,   //原31
    high    : 37,   //原37
    veryHigh: 99    
};

//各燈號出現次數
var lightCount = { 
    veryLow : 0,   
    low     : 0,
    normal  : 0,
    high    : 0,
    veryHigh: 0
}

//各燈號交易次數
var lightBuySellCount = { 
    veryLow : 0,   
    low     : 0,
    normal  : 0,
    high    : 0,
    veryHigh: 0
}


var Stock = []; //庫存

var win = 0;        //價差獲利
var prizeWin = 0;   //獲利

const average = arr => arr.reduce( ( p, c ) => p + c, 0 ) / arr.length;

var getNowValue = function(YYYYMM){
    return tw0050[YYYYMM] ? Number(tw0050[YYYYMM].toFixed(2)) : null;
}
var maxStock = 0; // 最大持倉量

var sell = function(nowPrice,light){
    if(Stock.length === 0){
        return 0;
    }

    Stock = Stock.sort(function(a, b){
        return b - a;
    });


    sellStock = Stock[0];//取出最高價的
    willWin = Number((nowPrice - sellStock).toFixed(2));

    if(willWin <= 0){
        return 0 ;
    }
    myMoney += Number(nowPrice*1000);
    Stock.shift();    //從庫存移除
    lightBuySellCount[light]++;
    win += willWin;
}

var buy = function(nowPrice,light){
    if(myMoney < nowPrice*1000){
        return ;
    }
    Stock.push(nowPrice);

    maxStock = Math.max(maxStock, Stock.length);
    myMoney -= Number(nowPrice*1000);
    lightBuySellCount[light]++;
}

for (var YYYYMM in lightValue) {
    // 如果查無當月price，則跳掉
    var nowPrice = getNowValue(YYYYMM);
    if(getNowValue(YYYYMM) === null){
        continue;
    }

    light = lightValue[YYYYMM];

    for (var key in rangeConfig) {
        if(light <= rangeConfig[key]){
            lightCount[key]++;
            switch (key) {
                case 'veryLow':
                    buy(nowPrice,key);
                    buy(nowPrice,key);
                    buy(nowPrice,key);
                    buy(nowPrice,key);
                break;
                case 'low':
                    buy(nowPrice,key);
                break;
                case 'normal':
               
                break;
                case 'high':
                    sell(nowPrice,key);
                    sell(nowPrice,key);
                    sell(nowPrice,key);
                break;
                case 'veryHigh':
                    sell(nowPrice,key);
                    sell(nowPrice,key);
                    sell(nowPrice,key);
                    sell(nowPrice,key);
                    sell(nowPrice,key);
                    sell(nowPrice,key);
                break;
            }
            break;
        }
    }
    //如果是10月，則派股利
    if(YYYYMM.split('-')[1] == '10'){
        prize = Stock.length  * nowPrice * 0.03 * 1000;
        
        prize -= prize*0.02;
        prize = Number(prize.toFixed(0));
        myMoney += prize;
        prizeWin += prize;
    }
};

console.log(lightCount);
console.log(lightBuySellCount);

console.log("\n庫存還有："+Stock.length +" 張");

console.log("\n買入均價："+Number(average( Stock ).toFixed(2))  );

console.log("\n最大持倉："+maxStock);

console.log("\n價差獲利："+Number(win.toFixed(2))*1000);

console.log("\n股利獲利："+Number(prizeWin.toFixed(0)));

console.log("\n總獲利："+ ((Number(win.toFixed(2))*1000) + Number(prizeWin.toFixed(0))))