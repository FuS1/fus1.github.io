<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>排班系統 - 員工管理</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans">

    <div class="container mx-auto p-4 md:p-8">
        <header class="mb-6 flex justify-between items-center">
            <div>
                <h1 class="text-4xl font-bold text-white">員工管理</h1>
                <p class="text-gray-400 mt-1">在這裡新增或查看員工資料</p>
            </div>
            <a href="schedule.html" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                前往排班頁面 &rarr;
            </a>
        </header>

        <!-- 新增員工表單 -->
        <div class="bg-gray-800 rounded-xl shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-semibold mb-4">新增員工</h2>
            <form id="employee-form" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                <div>
                    <label for="employee-name" class="block text-sm font-medium text-gray-300 mb-1">員工姓名</label>
                    <input type="text" id="employee-name" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div>
                    <label for="employee-store" class="block text-sm font-medium text-gray-300 mb-1">所屬門市</label>
                    <select id="employee-store" required class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"></select>
                </div>
                <button type="submit" class="w-full md:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition duration-200">
                    新增員工
                </button>
            </form>
        </div>

        <!-- 員工列表 -->
        <div class="bg-gray-800 rounded-xl shadow-lg p-6">
             <h2 class="text-2xl font-semibold mb-4">現有員工列表</h2>
             <div class="overflow-x-auto">
                <table class="w-full min-w-max text-left">
                    <thead class="border-b border-gray-700">
                        <tr>
                            <th class="p-3">員工姓名</th>
                            <th class="p-3">所屬門市</th>
                            <th class="p-3 text-right">操作</th>
                        </tr>
                    </thead>
                    <tbody id="employee-list"></tbody>
                </table>
             </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
    $(function() {
        const stores = [
            '台北 旗艦店', '公館 體驗店', '新店 威秀店',
            '青埔 環球店', '中壢 中原店',
            '竹北 六家店',
            '台中 旗艦店',
            '台南 中山店',
            '高雄 旗艦店', '高雄 夢時代店'
        ];

        function init() {
            seedInitialData(); // NEW: 新增預設資料
            populateStoreSelect();
            renderEmployeeList();
            bindEvents();
        }
        
        // NEW: 如果沒有員工資料，則建立一批範例資料
        function seedInitialData() {
            const hasEmployees = localStorage.getItem('employees');
            const hasSchedules = localStorage.getItem('schedules');
            
            if (!hasEmployees) {
                const initialEmployees = [
                    { id: 'emp_1', name: '王大明', store: '台北 旗艦店' },
                    { id: 'emp_2', name: '陳小美', store: '台北 旗艦店' },
                    { id: 'emp_3', name: '林經理', store: '台中 旗艦店' },
                    { id: 'emp_4', name: '李支援', store: '高雄 旗艦店' },
                    { id: 'emp_5', name: '吳正華', store: '中壢 中原店' },
                    { id: 'emp_6', name: '張全蛋', store: '竹北 六家店' },
                    { id: 'emp_7', name: '黃雅玲', store: '台中 旗艦店' },
                    { id: 'emp_8', name: '周子豪', store: '高雄 夢時代店' },
                    { id: 'emp_9', name: '蔡明哲', store: '青埔 環球店' },
                    { id: 'emp_10', name: '簡如萍', store: '新店 威秀店' },
                    { id: 'emp_11', name: '曾建宏', store: '公館 體驗店' },
                    { id: 'emp_12', name: '羅欣怡', store: '台南 中山店' },
                    { id: 'emp_13', name: '許國豪', store: '中壢 中原店' },
                    { id: 'emp_14', name: '鄭琬婷', store: '台北 旗艦店' },
                    { id: 'emp_15', name: '高志偉', store: '高雄 夢時代店' },
                    { id: 'emp_16', name: '林佩君', store: '竹北 六家店' },
                    { id: 'emp_17', name: '張育誠', store: '公館 體驗店' },
                    { id: 'emp_18', name: '陳慧文', store: '青埔 環球店' },
                    { id: 'emp_19', name: '劉志強', store: '台南 中山店' },
                    { id: 'emp_20', name: '何美玲', store: '新店 威秀店' },
                ];
                saveEmployees(initialEmployees);
            }

            if (!hasSchedules) {
                generateAndSaveSchedules();
            }

        }

        function generateAndSaveSchedules() {
            const employees = getEmployees();
            if (employees.length === 0) return;

            const schedules = [];
            const today = new Date();
            const startTimes = ['09:00', '10:00', '11:00', '12:00', '13:00', '14:00'];
            const durations = [6, 7, 8]; // in hours

            function addHoursToTime(timeStr, hours) {
                let [h, m] = timeStr.split(':').map(Number);
                h += hours;
                if (h >= 22) h = 22; // Cap at 22:00
                return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
            }
            
            function formatDate(date) { return date.toISOString().split('T')[0]; }
            
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            for (let i = 0; i < 30; i++) { // Generate for the next 30 days
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                const dateStr = formatDate(date);

                stores.forEach(store => {
                    const staffToSchedule = [];
                    const localStaff = employees.filter(e => e.store === store);
                    const otherStaff = employees.filter(e => e.store !== store);
                    
                    // Schedule 2 to 4 local staff
                    const shuffledLocal = shuffleArray([...localStaff]);
                    const localCount = Math.floor(Math.random() * 3) + 2; // 2, 3, or 4
                    staffToSchedule.push(...shuffledLocal.slice(0, localCount));

                    // 30% chance to add a support staff
                    if (Math.random() < 0.3 && otherStaff.length > 0) {
                        const supportStaff = otherStaff[Math.floor(Math.random() * otherStaff.length)];
                        staffToSchedule.push(supportStaff);
                    }

                    staffToSchedule.forEach(emp => {
                        const start = startTimes[Math.floor(Math.random() * startTimes.length)];
                        const duration = durations[Math.floor(Math.random() * durations.length)];
                        const end = addHoursToTime(start, duration);

                        schedules.push({
                            id: `sch_${Date.now()}_${Math.random()}`,
                            store: store,
                            date: dateStr,
                            employeeId: emp.id,
                            start: start,
                            end: end
                        });
                    });
                });
            }
            saveSchedules(schedules);
        }

        function populateStoreSelect() {
            const $select = $('#employee-store');
            stores.forEach(store => {
                $select.append(`<option value="${store}">${store}</option>`);
            });
        }
        
        function getEmployees() { return JSON.parse(localStorage.getItem('employees')) || []; }
        function saveEmployees(employees) { localStorage.setItem('employees', JSON.stringify(employees)); }
        function saveSchedules(schedules) { localStorage.setItem('schedules', JSON.stringify(schedules)); }

        function renderEmployeeList() {
            const employees = getEmployees();
            const $list = $('#employee-list');
            $list.empty();
            if (employees.length === 0) {
                $list.append('<tr><td colspan="3" class="p-4 text-center text-gray-500">尚未新增任何員工。</td></tr>');
                return;
            }
            employees.forEach((emp, index) => {
                const row = `
                    <tr class="border-b border-gray-700 hover:bg-gray-700 fade-in" style="animation-delay: ${index * 50}ms">
                        <td class="p-3">${emp.name}</td>
                        <td class="p-3">${emp.store}</td>
                        <td class="p-3 text-right">
                            <button class="delete-btn text-red-400 hover:text-red-600 text-sm" data-id="${emp.id}">刪除</button>
                        </td>
                    </tr>
                `;
                $list.append(row);
            });
        }

        function bindEvents() {
            $('#employee-form').on('submit', function(e) {
                e.preventDefault();
                const name = $('#employee-name').val();
                const store = $('#employee-store').val();
                if (name && store) {
                    const employees = getEmployees();
                    employees.push({ id: 'emp_' + Date.now(), name: name, store: store });
                    saveEmployees(employees);
                    renderEmployeeList();
                    $('#employee-name').val('');
                }
            });

            $('#employee-list').on('click', '.delete-btn', function() {
                if (confirm('確定要刪除這位員工嗎？')) {
                    const employeeId = $(this).data('id');
                    let employees = getEmployees();
                    employees = employees.filter(emp => emp.id !== employeeId);
                    saveEmployees(employees);
                    renderEmployeeList();
                }
            });
        }

        init();
    });
    </script>

</body>
</html>